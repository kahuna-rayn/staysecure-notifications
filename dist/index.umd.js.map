{"version":3,"file":"index.umd.js","sources":["../node_modules/lucide-react/dist/esm/shared/src/utils.js","../node_modules/lucide-react/dist/esm/defaultAttributes.js","../node_modules/lucide-react/dist/esm/Icon.js","../node_modules/lucide-react/dist/esm/createLucideIcon.js","../node_modules/lucide-react/dist/esm/icons/calendar.js","../node_modules/lucide-react/dist/esm/icons/circle-alert.js","../node_modules/lucide-react/dist/esm/icons/circle-check-big.js","../node_modules/lucide-react/dist/esm/icons/circle-x.js","../node_modules/lucide-react/dist/esm/icons/clock.js","../node_modules/lucide-react/dist/esm/icons/copy.js","../node_modules/lucide-react/dist/esm/icons/eye.js","../node_modules/lucide-react/dist/esm/icons/loader-circle.js","../node_modules/lucide-react/dist/esm/icons/mail.js","../node_modules/lucide-react/dist/esm/icons/plus.js","../node_modules/lucide-react/dist/esm/icons/refresh-cw.js","../node_modules/lucide-react/dist/esm/icons/search.js","../node_modules/lucide-react/dist/esm/icons/send.js","../node_modules/lucide-react/dist/esm/icons/square-pen.js","../node_modules/lucide-react/dist/esm/icons/trash-2.js","../node_modules/lucide-react/dist/esm/icons/user.js","../src/lib/emailService.ts","../src/components/EmailNotifications.tsx","../src/components/EmailTemplateManager.tsx","../src/components/RecentEmailNotifications.tsx","../src/utils/supabase.ts","../src/hooks/useNotifications.ts"],"sourcesContent":["/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nconst toKebabCase = (string) => string.replace(/([a-z0-9])([A-Z])/g, \"$1-$2\").toLowerCase();\nconst mergeClasses = (...classes) => classes.filter((className, index, array) => {\n  return Boolean(className) && className.trim() !== \"\" && array.indexOf(className) === index;\n}).join(\" \").trim();\n\nexport { mergeClasses, toKebabCase };\n//# sourceMappingURL=utils.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nvar defaultAttributes = {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  width: 24,\n  height: 24,\n  viewBox: \"0 0 24 24\",\n  fill: \"none\",\n  stroke: \"currentColor\",\n  strokeWidth: 2,\n  strokeLinecap: \"round\",\n  strokeLinejoin: \"round\"\n};\n\nexport { defaultAttributes as default };\n//# sourceMappingURL=defaultAttributes.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport { forwardRef, createElement } from 'react';\nimport defaultAttributes from './defaultAttributes.js';\nimport { mergeClasses } from './shared/src/utils.js';\n\nconst Icon = forwardRef(\n  ({\n    color = \"currentColor\",\n    size = 24,\n    strokeWidth = 2,\n    absoluteStrokeWidth,\n    className = \"\",\n    children,\n    iconNode,\n    ...rest\n  }, ref) => {\n    return createElement(\n      \"svg\",\n      {\n        ref,\n        ...defaultAttributes,\n        width: size,\n        height: size,\n        stroke: color,\n        strokeWidth: absoluteStrokeWidth ? Number(strokeWidth) * 24 / Number(size) : strokeWidth,\n        className: mergeClasses(\"lucide\", className),\n        ...rest\n      },\n      [\n        ...iconNode.map(([tag, attrs]) => createElement(tag, attrs)),\n        ...Array.isArray(children) ? children : [children]\n      ]\n    );\n  }\n);\n\nexport { Icon as default };\n//# sourceMappingURL=Icon.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport { forwardRef, createElement } from 'react';\nimport { mergeClasses, toKebabCase } from './shared/src/utils.js';\nimport Icon from './Icon.js';\n\nconst createLucideIcon = (iconName, iconNode) => {\n  const Component = forwardRef(\n    ({ className, ...props }, ref) => createElement(Icon, {\n      ref,\n      iconNode,\n      className: mergeClasses(`lucide-${toKebabCase(iconName)}`, className),\n      ...props\n    })\n  );\n  Component.displayName = `${iconName}`;\n  return Component;\n};\n\nexport { createLucideIcon as default };\n//# sourceMappingURL=createLucideIcon.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Calendar = createLucideIcon(\"Calendar\", [\n  [\"path\", { d: \"M8 2v4\", key: \"1cmpym\" }],\n  [\"path\", { d: \"M16 2v4\", key: \"4m81vk\" }],\n  [\"rect\", { width: \"18\", height: \"18\", x: \"3\", y: \"4\", rx: \"2\", key: \"1hopcy\" }],\n  [\"path\", { d: \"M3 10h18\", key: \"8toen8\" }]\n]);\n\nexport { Calendar as default };\n//# sourceMappingURL=calendar.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst CircleAlert = createLucideIcon(\"CircleAlert\", [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"line\", { x1: \"12\", x2: \"12\", y1: \"8\", y2: \"12\", key: \"1pkeuh\" }],\n  [\"line\", { x1: \"12\", x2: \"12.01\", y1: \"16\", y2: \"16\", key: \"4dfq90\" }]\n]);\n\nexport { CircleAlert as default };\n//# sourceMappingURL=circle-alert.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst CircleCheckBig = createLucideIcon(\"CircleCheckBig\", [\n  [\"path\", { d: \"M21.801 10A10 10 0 1 1 17 3.335\", key: \"yps3ct\" }],\n  [\"path\", { d: \"m9 11 3 3L22 4\", key: \"1pflzl\" }]\n]);\n\nexport { CircleCheckBig as default };\n//# sourceMappingURL=circle-check-big.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst CircleX = createLucideIcon(\"CircleX\", [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"path\", { d: \"m15 9-6 6\", key: \"1uzhvr\" }],\n  [\"path\", { d: \"m9 9 6 6\", key: \"z0biqf\" }]\n]);\n\nexport { CircleX as default };\n//# sourceMappingURL=circle-x.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Clock = createLucideIcon(\"Clock\", [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"polyline\", { points: \"12 6 12 12 16 14\", key: \"68esgv\" }]\n]);\n\nexport { Clock as default };\n//# sourceMappingURL=clock.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Copy = createLucideIcon(\"Copy\", [\n  [\"rect\", { width: \"14\", height: \"14\", x: \"8\", y: \"8\", rx: \"2\", ry: \"2\", key: \"17jyea\" }],\n  [\"path\", { d: \"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2\", key: \"zix9uf\" }]\n]);\n\nexport { Copy as default };\n//# sourceMappingURL=copy.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Eye = createLucideIcon(\"Eye\", [\n  [\n    \"path\",\n    {\n      d: \"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0\",\n      key: \"1nclc0\"\n    }\n  ],\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"3\", key: \"1v7zrd\" }]\n]);\n\nexport { Eye as default };\n//# sourceMappingURL=eye.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst LoaderCircle = createLucideIcon(\"LoaderCircle\", [\n  [\"path\", { d: \"M21 12a9 9 0 1 1-6.219-8.56\", key: \"13zald\" }]\n]);\n\nexport { LoaderCircle as default };\n//# sourceMappingURL=loader-circle.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Mail = createLucideIcon(\"Mail\", [\n  [\"rect\", { width: \"20\", height: \"16\", x: \"2\", y: \"4\", rx: \"2\", key: \"18n3k1\" }],\n  [\"path\", { d: \"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7\", key: \"1ocrg3\" }]\n]);\n\nexport { Mail as default };\n//# sourceMappingURL=mail.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Plus = createLucideIcon(\"Plus\", [\n  [\"path\", { d: \"M5 12h14\", key: \"1ays0h\" }],\n  [\"path\", { d: \"M12 5v14\", key: \"s699le\" }]\n]);\n\nexport { Plus as default };\n//# sourceMappingURL=plus.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst RefreshCw = createLucideIcon(\"RefreshCw\", [\n  [\"path\", { d: \"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\", key: \"v9h5vc\" }],\n  [\"path\", { d: \"M21 3v5h-5\", key: \"1q7to0\" }],\n  [\"path\", { d: \"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\", key: \"3uifl3\" }],\n  [\"path\", { d: \"M8 16H3v5\", key: \"1cv678\" }]\n]);\n\nexport { RefreshCw as default };\n//# sourceMappingURL=refresh-cw.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Search = createLucideIcon(\"Search\", [\n  [\"circle\", { cx: \"11\", cy: \"11\", r: \"8\", key: \"4ej97u\" }],\n  [\"path\", { d: \"m21 21-4.3-4.3\", key: \"1qie3q\" }]\n]);\n\nexport { Search as default };\n//# sourceMappingURL=search.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Send = createLucideIcon(\"Send\", [\n  [\n    \"path\",\n    {\n      d: \"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z\",\n      key: \"1ffxy3\"\n    }\n  ],\n  [\"path\", { d: \"m21.854 2.147-10.94 10.939\", key: \"12cjpa\" }]\n]);\n\nexport { Send as default };\n//# sourceMappingURL=send.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst SquarePen = createLucideIcon(\"SquarePen\", [\n  [\"path\", { d: \"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\", key: \"1m0v6g\" }],\n  [\n    \"path\",\n    {\n      d: \"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z\",\n      key: \"ohrbg2\"\n    }\n  ]\n]);\n\nexport { SquarePen as default };\n//# sourceMappingURL=square-pen.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Trash2 = createLucideIcon(\"Trash2\", [\n  [\"path\", { d: \"M3 6h18\", key: \"d0wm0j\" }],\n  [\"path\", { d: \"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6\", key: \"4alrt4\" }],\n  [\"path\", { d: \"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2\", key: \"v07s0e\" }],\n  [\"line\", { x1: \"10\", x2: \"10\", y1: \"11\", y2: \"17\", key: \"1uufr5\" }],\n  [\"line\", { x1: \"14\", x2: \"14\", y1: \"11\", y2: \"17\", key: \"xtxkd\" }]\n]);\n\nexport { Trash2 as default };\n//# sourceMappingURL=trash-2.js.map\n","/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst User = createLucideIcon(\"User\", [\n  [\"path\", { d: \"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2\", key: \"975kel\" }],\n  [\"circle\", { cx: \"12\", cy: \"7\", r: \"4\", key: \"17ys0d\" }]\n]);\n\nexport { User as default };\n//# sourceMappingURL=user.js.map\n","// Email service using Lambda + SES for better security\n\nexport interface EmailData {\n  to: string;\n  subject: string;\n  htmlBody: string;\n  textBody?: string;\n  from?: string;\n}\n\nexport interface SendEmailResult {\n  success: boolean;\n  messageId?: string;\n  error?: string;\n  skipped?: boolean;\n  skipReason?: string;\n}\n\nexport interface EmailTemplate {\n  id: string;\n  name: string;\n  type: string;\n  subject_template: string;\n  html_body_template: string;\n  text_body_template?: string | null;\n  variables?: string[] | null;\n  is_active?: boolean | null;\n  system: boolean;\n}\n\nexport class EmailService {\n  private static instance: EmailService;\n  private defaultFrom: string;\n  private baseUrl: string;\n\n  private constructor() {\n    // This will be set by the consuming app via configure() if needed\n    // We can't use Deno.env here as this runs in browser/Node.js, not Deno\n    // Note: We now use Supabase Edge Function, so lambdaUrl is not needed\n    this.defaultFrom = 'kahuna@raynsecure.com';\n    this.baseUrl = '';\n  }\n\n  public static getInstance(): EmailService {\n    if (!EmailService.instance) {\n      EmailService.instance = new EmailService();\n    }\n    return EmailService.instance;\n  }\n\n  public static configure(config: {\n    fromEmail?: string;\n    baseUrl?: string;\n  }): void {\n    const instance = EmailService.getInstance();\n    if (config.fromEmail) {\n      instance.defaultFrom = config.fromEmail;\n    }\n    if (config.baseUrl) {\n      instance.baseUrl = config.baseUrl;\n    }\n  }\n\n  // Helper method to generate lesson URLs\n  public generateLessonUrl(lessonId: string, clientPath?: string): string {\n    if (!this.baseUrl) {\n      console.warn('Base URL not configured. Please configure EmailService with baseUrl.');\n      return `#/lesson/${lessonId}`;\n    }\n    \n    const base = this.baseUrl.endsWith('/') ? this.baseUrl.slice(0, -1) : this.baseUrl;\n    const path = clientPath ? `/${clientPath}` : '';\n    return `${base}${path}/#/lesson/${lessonId}`;\n  }\n\n  // Template variable substitution with Handlebars-like conditionals and loops support\n  // Made public so it can be used in preview\n  public substituteVariables(template: string, variables: Record<string, any>): string {\n    let result = template;\n    \n    // Step 1: Process loops first ({{#each array_key}}...{{/each}})\n    // This allows variables inside loops to reference array item properties\n    const eachPattern = /\\{\\{#each\\s+(\\w+)\\}\\}([\\s\\S]*?)\\{\\{\\/each\\}\\}/g;\n    const eachMatches = Array.from(template.matchAll(eachPattern));\n    \n    // Only process loops if they actually exist in the template\n    if (eachMatches.length > 0) {\n      console.log('substituteVariables - Found {{#each}} loops:', eachMatches.length, eachMatches.map(m => ({ key: m[1], content: m[2].substring(0, 50) })));\n      \n      result = result.replace(eachPattern, (_match, arrayKey, loopContent) => {\n        console.log(`substituteVariables - Processing {{#each ${arrayKey}}}:`, {\n          arrayKey,\n          arrayValue: variables[arrayKey],\n          isArray: Array.isArray(variables[arrayKey]),\n          length: Array.isArray(variables[arrayKey]) ? variables[arrayKey].length : 'N/A',\n          loopContent: loopContent.substring(0, 100)\n        });\n        \n        const arrayValue = variables[arrayKey];\n        if (!Array.isArray(arrayValue) || arrayValue.length === 0) {\n          console.log(`substituteVariables - Skipping {{#each ${arrayKey}}} - not an array or empty`);\n          return ''; // Hide loop if array is empty or not an array\n        }\n        \n        // Process each item in the array\n        const itemsHtml = arrayValue.map((item: any) => {\n          let itemHtml = loopContent;\n          // Replace {{property}} with item.property value\n          // Handle nested properties like {{lesson_title}} or {{learning_track_title}}\n          itemHtml = itemHtml.replace(/\\{\\{(\\w+)\\}\\}/g, (varMatch: string, propKey: string) => {\n            const value = item[propKey] !== undefined ? String(item[propKey] || '') : varMatch;\n            return value;\n          });\n          return itemHtml;\n        }).join('');\n        \n        console.log(`substituteVariables - {{#each ${arrayKey}}} result:`, itemsHtml.substring(0, 200));\n        return itemsHtml;\n      });\n    }\n    \n    // Step 2: Handle Handlebars conditionals {{#if variable}}...{{/if}}\n    // Remove blocks where the condition is false/undefined/null\n    result = result.replace(/\\{\\{#if\\s+(\\w+)\\}\\}([\\s\\S]*?)\\{\\{\\/if\\}\\}/g, (_match, variableName, content) => {\n      const value = variables[variableName];\n      // Show content if variable is truthy and not empty string\n      if (value && value !== '' && value !== 'false' && value !== '0') {\n        return content;\n      }\n      return ''; // Remove the block if condition is false\n    });\n    \n    // Step 3: Substitute all remaining variables (skip arrays - they're handled by loops)\n    for (const [key, value] of Object.entries(variables)) {\n      if (Array.isArray(value)) {\n        // Skip arrays - they're handled by loops above\n        continue;\n      }\n      const regex = new RegExp(`\\\\{\\\\{${key}\\\\}\\\\}`, 'g');\n      result = result.replace(regex, String(value || ''));\n    }\n    \n    return result;\n  }\n\n  // Fetch template from database\n  private async fetchTemplate(\n    type: string,\n    supabaseClient: any\n  ): Promise<EmailTemplate | null> {\n    try {\n      const { data, error } = await supabaseClient\n        .from('email_templates')\n        .select('*')\n        .eq('type', type)\n        .eq('is_active', true)\n        .order('system', { ascending: false }) // Prefer system templates\n        .limit(1)\n        .single();\n\n      if (error) {\n        console.error(`Error fetching template for type ${type}:`, error);\n        return null;\n      }\n\n      return data;\n    } catch (error) {\n      console.error(`Error fetching template for type ${type}:`, error);\n      return null;\n    }\n  }\n\n  // Send email using template from database\n  async sendEmailFromTemplate(\n    type: string,\n    to: string,\n    variables: Record<string, any>,\n    supabaseClient?: any,\n    options: {\n      userId?: string;\n      respectPreferences?: boolean;\n    } = {}\n  ): Promise<SendEmailResult> {\n    try {\n      const { userId, respectPreferences = true } = options;\n\n      if (respectPreferences && userId && supabaseClient) {\n        const preferenceCheck = await this.checkEmailPreferences(\n          supabaseClient,\n          userId,\n          type\n        );\n\n        if (!preferenceCheck.allow) {\n          return {\n            success: false,\n            skipped: true,\n            skipReason: preferenceCheck.reason || 'preference_blocked',\n          };\n        }\n      }\n\n      // Fetch template from database\n      const template = await this.fetchTemplate(type, supabaseClient);\n\n      if (!template) {\n        return {\n          success: false,\n          error: `No active template found for type: ${type}`,\n        };\n      }\n\n      // Substitute variables in subject and body\n      const subject = this.substituteVariables(template.subject_template, variables);\n      const htmlBody = this.substituteVariables(template.html_body_template, variables);\n      const textBody = template.text_body_template\n        ? this.substituteVariables(template.text_body_template, variables)\n        : undefined;\n\n      // Send the email\n      return await this.sendEmail(\n        {\n          to,\n          subject,\n          htmlBody,\n          textBody,\n        },\n        supabaseClient\n      );\n    } catch (error: any) {\n      console.error('Error sending email from template:', error);\n      return {\n        success: false,\n        error: error.message || 'Failed to send email from template',\n      };\n    }\n  }\n\n  async sendEmail(\n    emailData: EmailData,\n    supabaseClient?: any,\n    notificationId?: string\n  ): Promise<SendEmailResult> {\n    try {\n      if (!supabaseClient) {\n        throw new Error('Supabase client is required to send email');\n      }\n\n      // Call Supabase Edge Function instead of Lambda directly\n      // The Edge Function will use AUTH_LAMBDA_URL from Supabase secrets\n      const { data, error } = await supabaseClient.functions.invoke('send-email', {\n        body: {\n          to: emailData.to,\n          subject: emailData.subject,\n          html: emailData.htmlBody,\n          text: emailData.textBody,\n        },\n      });\n\n      if (error) {\n        const errorMessage = error.message || 'Failed to send email via Edge Function';\n        if (notificationId && supabaseClient) {\n          await this.updateNotificationStatus(\n            supabaseClient,\n            notificationId,\n            'failed',\n            undefined,\n            errorMessage\n          );\n        }\n        return {\n          success: false,\n          error: errorMessage,\n        };\n      }\n\n      // The Edge Function returns { success: true, message: '...' }\n      // Extract messageId if available (Edge Function may not return messageId currently)\n      const messageId = typeof data?.messageId === 'string' && data.messageId.length > 0\n        ? data.messageId\n        : undefined;\n\n      if (notificationId && supabaseClient) {\n        await this.updateNotificationStatus(\n          supabaseClient,\n          notificationId,\n          'sent',\n          messageId\n        );\n      }\n\n      return {\n        success: true,\n        messageId,\n      };\n    } catch (error: any) {\n      console.error('Error sending email via Edge Function:', error);\n      if (notificationId && supabaseClient) {\n        await this.updateNotificationStatus(\n          supabaseClient,\n          notificationId,\n          'failed',\n          undefined,\n          error.message || 'Failed to send email'\n        );\n      }\n      return {\n        success: false,\n        error: error.message || 'Failed to send email',\n      };\n    }\n  }\n\n  // Deprecated legacy helpers removed: sendLessonReminder, sendTaskDueReminder, sendAchievementEmail,\n  // sendCourseCompletionEmail, sendSystemAlert. Use templates + sendEmailFromTemplate instead.\n\n  // Send email using provided template data directly (for testing)\n  async sendEmailWithTemplate(\n    subjectTemplate: string,\n    htmlBodyTemplate: string,\n    textBodyTemplate: string,\n    to: string,\n    variables: Record<string, any>,\n    supabaseClient?: any,\n    notificationId?: string\n  ): Promise<SendEmailResult> {\n    try {\n      // Substitute variables in templates\n      const subject = this.substituteVariables(subjectTemplate, variables);\n      const htmlBody = this.substituteVariables(htmlBodyTemplate, variables);\n      const textBody = this.substituteVariables(textBodyTemplate, variables);\n\n      return this.sendEmail({\n        to,\n        subject,\n        htmlBody,\n        textBody,\n      }, supabaseClient, notificationId);\n    } catch (error: any) {\n      console.error('Error sending email with template:', error);\n      return {\n        success: false,\n        error: error.message || 'Failed to send email with template',\n      };\n    }\n  }\n\n  // Update notification status in database\n  private async updateNotificationStatus(\n    supabaseClient: any,\n    notificationId: string,\n    status: 'sent' | 'failed',\n    messageId?: string,\n    errorMessage?: string\n  ): Promise<void> {\n    try {\n      const updateData: any = {\n        status,\n      };\n\n      if (status === 'sent') {\n        updateData.sent_at = new Date().toISOString();\n      }\n\n      if (messageId) {\n        updateData.message_id = messageId;\n      }\n\n      if (errorMessage) {\n        updateData.error_message = errorMessage;\n      }\n\n      const { error } = await supabaseClient\n        .from('notification_history')\n        .update(updateData)\n        .eq('id', notificationId);\n\n      if (error) {\n        console.error('Failed to update notification status:', error);\n      } else {\n        console.log(`Notification ${notificationId} status updated to ${status}`);\n        // Add delay for testing visibility\n        if (status === 'sent') {\n          console.log('⏱️ Status update completed - check Recent tab now!');\n        }\n      }\n    } catch (error) {\n      console.error('Error updating notification status:', error);\n    }\n  }\n\n  private async checkEmailPreferences(\n    supabaseClient: any,\n    userId: string,\n    notificationType: string\n  ): Promise<{ allow: boolean; reason?: string }> {\n    try {\n      // 1) Try user-level preferences first\n      const { data: userPrefs, error: userErr } = await supabaseClient\n        .from('email_preferences')\n        .select('*') // IMPORTANT: avoid selecting non-existent columns like 'types'\n        .eq('user_id', userId)\n        .maybeSingle();\n  \n      if (userErr) {\n        console.error('Failed to load email preferences (user-level):', userErr);\n        return { allow: true }; // preserve current behavior: don't block sending\n      }\n  \n      // 2) Fallback to org-level preferences (user_id IS NULL)\n      let data = userPrefs;\n      if (!data) {\n        const { data: orgPrefs, error: orgErr } = await supabaseClient\n          .from('email_preferences')\n          .select('*')\n          .is('user_id', null)\n          .maybeSingle();\n  \n        if (orgErr) {\n          console.error('Failed to load email preferences (org-level):', orgErr);\n          return { allow: true };\n        }\n  \n        data = orgPrefs;\n      }\n  \n      if (!data) return { allow: true };\n  \n      // Global enable\n      const emailEnabled = data.email_enabled ?? true;\n      if (!emailEnabled) return { allow: false, reason: 'email_disabled' };\n  \n      const normalizedType = (notificationType ?? '').toLowerCase();\n  \n      // If legacy JSON 'types' exists, keep legacy behavior\n      if (data.types) {\n        const typePreferences = (data.types || {}) as Record<string, { email?: boolean }>;\n        const typeConfig =\n          typePreferences[normalizedType] || typePreferences[normalizedType.toLowerCase()];\n        if (typeConfig && typeConfig.email === false) {\n          return { allow: false, reason: 'type_email_disabled' };\n        }\n      } else {\n        // Newer schema: boolean columns (skip checks if the column doesn't exist)\n        const isFalse = (v: any) => v === false;\n  \n        // Track/courses\n        if (normalizedType.startsWith('track_') || normalizedType.includes('course')) {\n          const flag = data.track_completions ?? data.course_completions;\n          if (isFalse(flag)) return { allow: false, reason: 'track_completions_disabled' };\n        }\n  \n        // Achievements/quizzes\n        if (normalizedType.startsWith('quiz_') || normalizedType.includes('achievement')) {\n          if (isFalse(data.achievements)) return { allow: false, reason: 'achievements_disabled' };\n        }\n  \n        // Lesson reminders\n        if (normalizedType.includes('lesson') && normalizedType.includes('reminder')) {\n          if (isFalse(data.lesson_reminders)) return { allow: false, reason: 'lesson_reminders_disabled' };\n        }\n  \n        // Task/system (optional)\n        if (normalizedType.includes('task')) {\n          if (isFalse(data.task_due_dates)) return { allow: false, reason: 'task_due_dates_disabled' };\n        }\n        if (normalizedType.includes('system')) {\n          if (isFalse(data.system_alerts)) return { allow: false, reason: 'system_alerts_disabled' };\n        }\n      }\n  \n      // Quiet hours: support both schemas\n      const quietHours = data.quiet_hours as\n        | { enabled?: boolean; startTime?: string; endTime?: string; timezone?: string }\n        | undefined;\n  \n      if (quietHours?.enabled) {\n        // existing legacy quiet_hours object logic can remain as-is\n        // ... keep your current quietHours parsing block here ...\n      } else if (data.quiet_hours_enabled) {\n        // email_preferences schema uses start/end time columns\n        const startStr = String(data.quiet_hours_start_time || '22:00:00').slice(0, 5); // HH:mm\n        const endStr = String(data.quiet_hours_end_time || '08:00:00').slice(0, 5);\n  \n        const now = new Date();\n        const currentMinutes = now.getHours() * 60 + now.getMinutes();\n  \n        const parseHHMM = (v: string) => {\n          const [h, m] = v.split(':').map(n => parseInt(n, 10));\n          if (Number.isNaN(h) || Number.isNaN(m)) return null;\n          return h * 60 + m;\n        };\n  \n        const start = parseHHMM(startStr);\n        const end = parseHHMM(endStr);\n  \n        if (start !== null && end !== null) {\n          const inQuietHours =\n            start <= end\n              ? currentMinutes >= start && currentMinutes < end\n              : currentMinutes >= start || currentMinutes < end;\n  \n          if (inQuietHours) return { allow: false, reason: 'quiet_hours' };\n        }\n      }\n  \n      return { allow: true };\n    } catch (error) {\n      console.error('Error checking email preferences:', error);\n      return { allow: true };\n    }\n  }\n}\nexport const emailService = EmailService.getInstance();\n\n/**\n * Gathers real variables from the database for lesson completion notifications\n * This is used when sending REAL notifications, not previews\n */\nexport async function gatherLessonCompletedVariables(\n  supabaseClient: any,\n  event: { \n    user_id: string; \n    lesson_id: string; \n    learning_track_id?: string;\n    clientId?: string;\n  }\n): Promise<Record<string, any>> {\n  try {\n    // Get user info - use username (which stores email) instead of email column\n    const { data: user } = await supabaseClient\n      .from('profiles')\n      .select('full_name, username')\n      .eq('id', event.user_id)\n      .single();\n\n    // Get lesson info\n    const { data: lesson } = await supabaseClient\n      .from('lessons')\n      .select('title, description')\n      .eq('id', event.lesson_id)\n      .single();\n\n    // Get learning track info if available\n    let track = null;\n    let progress = null;\n    let lessonsCompleted = 0;\n    let totalLessons = 0;\n    let nextLesson = null;\n    \n    if (event.learning_track_id) {\n      track = await supabaseClient\n        .from('learning_tracks')\n        .select('title')\n        .eq('id', event.learning_track_id)\n        .single();\n\n      // Get progress in track\n      progress = await supabaseClient\n        .from('user_learning_track_progress')\n        .select('current_lesson_order')\n        .eq('user_id', event.user_id)\n        .eq('learning_track_id', event.learning_track_id)\n        .maybeSingle();\n\n      // Count lessons completed in this track\n      const { data: completedLessons } = await supabaseClient\n        .from('user_lesson_progress')\n        .select('lesson_id')\n        .eq('user_id', event.user_id)\n        .not('completed_at', 'is', null);\n\n      // Get total lessons in track\n      const { data: trackLessons } = await supabaseClient\n        .from('learning_track_lessons')\n        .select('lesson_id')\n        .eq('learning_track_id', event.learning_track_id);\n\n      totalLessons = trackLessons?.length || 0;\n      \n      // Count how many completed lessons are in this track\n      const completedInTrack = completedLessons?.filter((cl: any) => \n        trackLessons?.some((tl: any) => tl.lesson_id === cl.lesson_id)\n      ).length || 0;\n      lessonsCompleted = completedInTrack;\n\n      // Get next lesson if available\n      const currentOrder = progress?.current_lesson_order || 0;\n      const { data: nextLessonData } = await supabaseClient\n        .from('learning_track_lessons')\n        .select('lesson_id, order_index, lessons(title)')\n        .eq('learning_track_id', event.learning_track_id)\n        .gt('order_index', currentOrder)\n        .order('order_index')\n        .limit(1)\n        .maybeSingle();\n\n      if (nextLessonData) {\n        nextLesson = {\n          title: (nextLessonData.lessons as any)?.title || 'Next Lesson',\n          id: nextLessonData.lesson_id\n        };\n      }\n    }\n\n    // Build client login URL\n    const origin = typeof window !== 'undefined' ? window.location.origin : 'https://staysecure-learn.raynsecure.com';\n    const clientId = event.clientId || 'default';\n    const clientPath = clientId !== 'default' ? `/${clientId}` : '';\n    const clientLoginUrl = `${origin}${clientPath}/login`;\n\n    // Calculate progress percentage\n    const trackProgressPercentage = totalLessons > 0 \n      ? Math.round((lessonsCompleted / totalLessons) * 100)\n      : 0;\n\n    return {\n      user_name: user?.full_name || 'User',\n      user_email: user?.username || '',\n      lesson_title: lesson?.title || 'Lesson',\n      lesson_description: lesson?.description || '',\n      learning_track_title: track?.title || '',\n      completion_date: new Date().toLocaleDateString('en-US'),\n      completion_time: new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }),\n      lessons_completed_in_track: lessonsCompleted,\n      total_lessons_in_track: totalLessons,\n      track_progress_percentage: trackProgressPercentage,\n      next_lesson_title: nextLesson?.title || null,\n      next_lesson_available: !!nextLesson,\n      next_lesson_url: clientLoginUrl, // Always use login URL as per requirement\n      client_login_url: clientLoginUrl\n    };\n  } catch (error) {\n    console.error('Error gathering lesson completed variables:', error);\n    // Return minimal fallback\n    return {\n      user_name: 'User',\n      lesson_title: 'Lesson',\n      client_login_url: 'https://staysecure-learn.raynsecure.com/login'\n    };\n  }\n}\n","import React, { useState, useEffect } from 'react';\nimport { Mail } from 'lucide-react';\nimport { EmailService } from '../lib/emailService';\n\n// These should be passed as props or configured externally\ninterface EmailNotificationsProps {\n  // Supabase client - should be passed from the consuming app\n  supabase: any;\n  // User object - should be passed from the consuming app\n  user: any;\n  // AWS configuration - should be passed from the consuming app\n  awsConfig?: {\n    lambdaUrl: string;\n    fromEmail: string;\n  };\n  // UI components - should be passed from the consuming app\n  Button: any;\n  Card: any;\n  CardContent: any;\n  CardDescription: any;\n  CardHeader: any;\n  CardTitle: any;\n  Input: any;\n  Label: any;\n  Switch: any;\n  Select: any;\n  SelectContent: any;\n  SelectItem: any;\n  SelectTrigger: any;\n  SelectValue: any;\n  Textarea: any;\n}\n\n\ninterface EmailPreferences {\n  id?: string;\n  userId?: string; // NULL for org-level, user UUID for user-level\n  emailEnabled: boolean;\n  taskDueDates: boolean;\n  systemAlerts: boolean;\n  achievements: boolean;\n  trackCompletions: boolean;\n  lessonReminders: boolean;\n  quietHoursEnabled: boolean;\n  quietHoursStart: string;\n  quietHoursEnd: string;\n  // Reminder settings (consolidated from lesson_reminder_config)\n  reminderDaysBefore: number;\n  reminderTime: string;\n  includeUpcomingLessons: boolean;\n  upcomingDaysAhead: number;\n  maxReminderAttempts: number;\n  reminderFrequencyDays: number;\n}\n\n// ReminderSettings interface removed - now part of EmailPreferences\n\nexport const EmailNotifications: React.FC<EmailNotificationsProps> = ({\n  supabase,\n  user, // Keep for now for auth context, but not used for preferences\n  awsConfig,\n  Button,\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n  Input,\n  Label,\n  Switch,\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n  Textarea,\n}) => {\n  const [preferences, setPreferences] = useState<EmailPreferences | null>(null);\n  const [loading, setLoading] = useState(true);\n\n  // Configure email service with AWS config\n  useEffect(() => {\n    if (awsConfig) {\n      EmailService.configure(awsConfig);\n    }\n  }, [awsConfig]);\n\n  // Load user preferences and reminder settings\n  useEffect(() => {\n    loadPreferences(); // Load org-level preferences (no user dependency)\n  }, []);\n\n  const loadPreferences = async () => {\n    try {\n      // Simple algorithm: load the one org-level row\n      const { data, error } = await supabase\n        .from('email_preferences')\n        .select('*')\n        .is('user_id', null)\n        .single();\n\n      if (error) {\n        console.error('Error loading preferences:', error);\n        return;\n      }\n\n      if (data) {\n        // Map database columns to component interface\n        const mappedData: EmailPreferences = {\n          id: data.id,\n          userId: data.user_id, // Will be null for org-level\n          emailEnabled: data.email_enabled,\n          taskDueDates: data.task_due_dates,\n          systemAlerts: data.system_alerts,\n          achievements: data.achievements,\n          trackCompletions: data.track_completions,\n          lessonReminders: data.lesson_reminders ?? true, // Default to true if null\n          quietHoursEnabled: data.quiet_hours_enabled,\n          quietHoursStart: data.quiet_hours_start_time,\n          quietHoursEnd: data.quiet_hours_end_time,\n          // Reminder settings (now part of the same table)\n          reminderDaysBefore: data.reminder_days_before,\n          reminderTime: data.reminder_time,\n          includeUpcomingLessons: data.include_upcoming_lessons,\n          upcomingDaysAhead: data.upcoming_days_ahead,\n          maxReminderAttempts: data.max_reminder_attempts,\n          reminderFrequencyDays: data.reminder_frequency_days,\n        };\n        setPreferences(mappedData);\n      }\n    } catch (error) {\n      console.error('Error loading preferences:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Simple algorithm: just load existing row, no creation logic needed\n\n  const updatePreferences = async (updates: Partial<EmailPreferences>) => {\n    const updatedPrefs = { \n      ...preferences, \n      ...updates, \n      userId: null // Always org-level settings\n    };\n    setPreferences(updatedPrefs);\n\n    // Get current user for audit fields\n    const { data: { user: currentUser } } = await supabase.auth.getUser();\n\n    const dbPayload = {\n      user_id: null, // Always org-level settings\n      email_enabled: updatedPrefs.emailEnabled,\n      task_due_dates: updatedPrefs.taskDueDates,\n      system_alerts: updatedPrefs.systemAlerts,\n      achievements: updatedPrefs.achievements,\n      track_completions: updatedPrefs.trackCompletions,\n      lesson_reminders: updatedPrefs.lessonReminders,\n      quiet_hours_enabled: updatedPrefs.quietHoursEnabled,\n      quiet_hours_start_time: updatedPrefs.quietHoursStart,\n      quiet_hours_end_time: updatedPrefs.quietHoursEnd,\n      // Reminder settings (consolidated)\n      reminder_days_before: updatedPrefs.reminderDaysBefore,\n      reminder_time: updatedPrefs.reminderTime,\n      include_upcoming_lessons: updatedPrefs.includeUpcomingLessons,\n      upcoming_days_ahead: updatedPrefs.upcomingDaysAhead,\n      max_reminder_attempts: updatedPrefs.maxReminderAttempts,\n      reminder_frequency_days: updatedPrefs.reminderFrequencyDays,\n      // Audit fields\n      updated_by: currentUser?.id || null,\n    };\n\n    // Update the existing org-level row (user_id IS NULL)\n    const { error } = await supabase\n      .from('email_preferences')\n      .update(dbPayload)\n      .is('user_id', null);\n\n    if (error) {\n      console.error('Error updating preferences:', error);\n    }\n  };\n\n  // loadReminderSettings removed - now part of loadPreferences\n\n  // saveReminderSettingsAuto removed - now uses updatePreferences directly\n\n  // saveReminderSettings removed - now uses updatePreferences directly\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center p-8\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-learning-primary\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center gap-2\">\n        <Mail className=\"h-6 w-6 text-learning-primary\" />\n        <h2 className=\"text-2xl font-bold text-learning-primary\">Email Preferences</h2>\n      </div>\n\n      {/* Email Preferences */}\n      <div className=\"space-y-6\">\n          {/* Global Email Toggle */}\n          <div className=\"flex items-center justify-between\">\n            <div className=\"text-left\">\n              <Label htmlFor=\"email-enabled\">Enable Email Notifications</Label>\n            </div>\n            <Switch\n              id=\"email-enabled\"\n              checked={preferences?.emailEnabled || false}\n              onCheckedChange={(checked) => updatePreferences({ emailEnabled: checked })}\n            />\n          </div>\n\n          {/* Reminder Limits - Right below Enable Email Toggle */}\n          {preferences?.emailEnabled && (\n            <div className=\"grid grid-cols-2 gap-4 pl-4 border-l-2 border-blue-200\">\n              <div>\n                <Label htmlFor=\"max-attempts\" className=\"text-sm\">Max Reminder Attempts</Label>\n                <Input\n                  id=\"max-attempts\"\n                  type=\"number\"\n                  min=\"1\"\n                  max=\"10\"\n                  value={preferences?.maxReminderAttempts || 3}\n                         onChange={(e) => updatePreferences({ maxReminderAttempts: parseInt(e.target.value) || 3 })}\n                  className=\"mt-1\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"reminder-frequency\" className=\"text-sm\">Reminder Frequency (Days)</Label>\n                <Input\n                  id=\"reminder-frequency\"\n                  type=\"number\"\n                  min=\"1\"\n                  max=\"30\"\n                  value={preferences?.reminderFrequencyDays || 7}\n                         onChange={(e) => updatePreferences({ reminderFrequencyDays: parseInt(e.target.value) || 7 })}\n                  className=\"mt-1\"\n                />\n              </div>\n            </div>\n          )}\n\n\n          {/* Notification Type Preferences */}\n          {preferences?.emailEnabled && (\n            <div className=\"space-y-4\">\n              <h4 className=\"font-medium\">Notification Types</h4>\n              \n                <div className=\"flex items-center justify-between\">\n                  <Label className=\"text-left\">Achievements</Label>\n                  <Switch\n                    checked={preferences?.achievements || false}\n                    onCheckedChange={(checked) => updatePreferences({ achievements: checked })}\n                  />\n                </div>\n                \n                <div className=\"flex items-center justify-between\">\n                  <Label className=\"text-left\">Lesson Track Completions</Label>\n                  <Switch\n                    checked={preferences?.trackCompletions || false}\n                    onCheckedChange={(checked) => updatePreferences({ trackCompletions: checked })}\n                  />\n                </div>\n\n                {/* Lesson Reminders - Enhanced */}\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <Label className=\"text-left font-medium\">Lesson Reminders</Label>\n                    <Switch\n                    checked={preferences?.lessonReminders ?? true}\n                    onCheckedChange={(checked) => {\n                      updatePreferences({ \n                        lessonReminders: checked,\n                        // Also update reminderDaysBefore to maintain consistency\n                        reminderDaysBefore: checked ? (preferences?.reminderDaysBefore ?? 1) : -1\n                      });\n                    }}\n                    />\n                  </div>\n                  \n                  {preferences?.lessonReminders && (\n                    <div className=\"space-y-4 pl-4 border-l-2 border-blue-200\">\n                      <div className=\"grid grid-cols-2 gap-4\">\n                        <div>\n                          <Label htmlFor=\"reminder-days\" className=\"text-sm\">Days before lesson</Label>\n                          <Input\n                            id=\"reminder-days\"\n                            type=\"number\"\n                            min=\"0\"\n                            max=\"7\"\n                            value={preferences?.reminderDaysBefore || 0}\n                            onChange={(e) => updatePreferences({ reminderDaysBefore: parseInt(e.target.value) || 0 })}\n                            className=\"mt-1\"\n                          />\n                        </div>\n                        <div>\n                          <Label htmlFor=\"reminder-time\" className=\"text-sm\">Send at time</Label>\n                          <Input\n                            id=\"reminder-time\"\n                            type=\"time\"\n                            value={preferences?.reminderTime || '09:00'}\n                            onChange={(e) => updatePreferences({ reminderTime: e.target.value })}\n                            className=\"mt-1\"\n                          />\n                        </div>\n                      </div>\n                    </div>\n                  )}\n                </div>\n\n                {/* Upcoming Lessons - Enhanced */}\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <Label className=\"text-left font-medium\">Upcoming Lessons</Label>\n                    <Switch\n                      checked={preferences?.includeUpcomingLessons || false}\n                      onCheckedChange={(checked) => updatePreferences({ includeUpcomingLessons: checked })}\n                    />\n                  </div>\n                  \n                  {preferences?.includeUpcomingLessons && (\n                    <div className=\"pl-4 border-l-2 border-green-200\">\n                      <div>\n                        <Label htmlFor=\"upcoming-days\" className=\"text-sm\">Look ahead days</Label>\n                        <Input\n                          id=\"upcoming-days\"\n                          type=\"number\"\n                          min=\"1\"\n                          max=\"14\"\n                          value={preferences?.upcomingDaysAhead || 3}\n                            onChange={(e) => updatePreferences({ upcomingDaysAhead: parseInt(e.target.value) || 3 })}\n                          className=\"mt-1\"\n                        />\n                      </div>\n                    </div>\n                  )}\n                </div>\n                \n                {/* Task Due Dates and System Alerts */}\n                <div className=\"space-y-3\">\n                <div className=\"flex items-center justify-between\">\n                  <Label className=\"text-left\">Task Due Dates</Label>\n                  <Switch\n                    checked={preferences?.taskDueDates || false}\n                    onCheckedChange={(checked) => updatePreferences({ taskDueDates: checked })}\n                  />\n                </div>\n                \n                <div className=\"flex items-center justify-between\">\n                  <Label className=\"text-left\">System Alerts</Label>\n                  <Switch\n                    checked={preferences?.systemAlerts || false}\n                    onCheckedChange={(checked) => updatePreferences({ systemAlerts: checked })}\n                  />\n                </div>\n                \n              </div>\n            </div>\n          )}\n\n          {/* Quiet Hours */}\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"text-left\">\n                <Label>Quiet Hours</Label>\n                <p className=\"text-sm text-muted-foreground\">\n                  Don't send emails during these hours\n                </p>\n              </div>\n              <Switch\n                checked={preferences?.quietHoursEnabled || false}\n                onCheckedChange={(checked) => updatePreferences({ quietHoursEnabled: checked })}\n              />\n            </div>\n\n            {preferences?.quietHoursEnabled && (\n              <div className=\"flex items-center gap-4\">\n                <div>\n                  <Label>Start Time</Label>\n                  <Input\n                    type=\"time\"\n                    value={preferences?.quietHoursStart || '22:00'}\n                    onChange={(e) => updatePreferences({ quietHoursStart: e.target.value })}\n                  />\n                </div>\n                <div>\n                  <Label>End Time</Label>\n                  <Input\n                    type=\"time\"\n                    value={preferences?.quietHoursEnd || '08:00'}\n                    onChange={(e) => updatePreferences({ quietHoursEnd: e.target.value })}\n                  />\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n  );\n};\n\n","import React, { useState, useEffect } from 'react';\nimport { \n  Plus, \n  Search, \n  Edit, \n  Eye, \n  Trash2, \n  Copy,\n  Send,\n  Mail,\n  Loader2,\n  CheckCircle,\n  XCircle\n} from 'lucide-react';\nimport { emailService } from '../lib/emailService';\n\ninterface EmailTemplate {\n  id: string;\n  name: string;\n  type: string;\n  subject_template: string;\n  html_body_template: string;\n  text_body_template?: string | null;\n  variables?: any;\n  is_system: boolean;\n  is_active?: boolean | null;\n  created_at: string;\n  updated_at?: string | null;\n}\n\ninterface EmailTemplateManagerProps {\n  supabaseClient: any;\n  Button: any;\n  Card: any;\n  CardContent: any;\n  CardDescription: any;\n  CardHeader: any;\n  CardTitle: any;\n  Input: any;\n  Label: any;\n  Badge: any;\n  Select: any;\n  SelectContent: any;\n  SelectItem: any;\n  SelectTrigger: any;\n  SelectValue: any;\n  Alert: any;\n  AlertDescription: any;\n  Dialog: any;\n  DialogContent: any;\n  DialogHeader: any;\n  DialogTitle: any;\n  DialogTrigger: any;\n  Textarea: any;\n  Popover: any;\n  PopoverContent: any;\n  PopoverTrigger: any;\n  isSuperAdmin?: boolean;\n  gatherTemplateVariables?: (supabase: any, eventType: string, context: any, templateText?: string) => Promise<Record<string, unknown>>;\n  toast?: (options: { title: string; description?: string; variant?: 'default' | 'destructive' }) => void;\n}\n\nexport default function EmailTemplateManager({\n  supabaseClient,\n  Button,\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n  Input,\n  Label,\n  Badge,\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n  Alert,\n  AlertDescription,\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n  Textarea,\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n  isSuperAdmin = false,\n  gatherTemplateVariables,\n  toast\n}: EmailTemplateManagerProps) {\n  const [templates, setTemplates] = useState<EmailTemplate[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [statusFilter, setStatusFilter] = useState<string>('all');\n  const [typeFilter, setTypeFilter] = useState<string>('all');\n  const [selectedTemplate, setSelectedTemplate] = useState<EmailTemplate | null>(null);\n  const [isEditing, setIsEditing] = useState(false);\n  const [isViewing, setIsViewing] = useState(false);\n  const [isCreating, setIsCreating] = useState(false);\n  const [sendingEmail, setSendingEmail] = useState<string | null>(null);\n  const [emailDialog, setEmailDialog] = useState<{\n    open: boolean;\n    type: 'success' | 'error';\n    message: string;\n  }>({ open: false, type: 'success', message: '' });\n  const [previewVariables, setPreviewVariables] = useState<Record<string, unknown> | null>(null);\n  const [loadingPreview, setLoadingPreview] = useState(false);\n\n  // Add CSS animation keyframes\n  React.useEffect(() => {\n    const style = document.createElement('style');\n    style.textContent = `\n      @keyframes spin {\n        from { transform: rotate(0deg); }\n        to { transform: rotate(360deg); }\n      }\n    `;\n    document.head.appendChild(style);\n    return () => {\n      if (document.head.contains(style)) {\n        document.head.removeChild(style);\n      }\n    };\n  }, []);\n\n  // Load templates\n  useEffect(() => {\n    loadTemplates();\n  }, []);\n\n  const loadTemplates = async () => {\n    try {\n      setLoading(true);\n      const { data, error } = await supabaseClient\n        .from('email_templates')\n        .select('*')\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n      setTemplates(data || []);\n    } catch (err: any) {\n      setError(err.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleEdit = (template: EmailTemplate) => {\n    setSelectedTemplate(template);\n    setIsEditing(true);\n  };\n\n  const handleView = async (template: EmailTemplate) => {\n    setSelectedTemplate(template);\n    setIsViewing(true);\n    setLoadingPreview(true);\n    \n    // Always use gatherTemplateVariables to get real data from database\n    if (!gatherTemplateVariables) {\n      console.error('gatherTemplateVariables is required for preview');\n      setLoadingPreview(false);\n      return;\n    }\n    \n    try {\n      // Query for sample data to use as context - using real data from database\n      const { data: sampleUser } = await supabaseClient\n        .from('profiles')\n        .select('id')\n        .limit(1)\n        .single();\n      \n      if (!sampleUser) {\n        console.error('No user found for preview');\n        setLoadingPreview(false);\n        return;\n      }\n      \n      const context: any = { user_id: sampleUser.id };\n      \n      // Try to get sample lesson_id for lesson-related templates\n      if (template.type === 'lesson_completed' || template.type === 'quiz_high_score' || template.type === 'lesson_reminder') {\n        const { data: sampleLesson } = await supabaseClient\n          .from('lessons')\n          .select('id')\n          .limit(1)\n          .single();\n        if (sampleLesson) context.lesson_id = sampleLesson.id;\n      }\n      \n      // Try to get sample learning_track_id for track-related templates\n      if (template.type.includes('track_milestone') || template.type === 'lesson_completed') {\n        const { data: sampleTrack } = await supabaseClient\n          .from('learning_tracks')\n          .select('id')\n          .limit(1)\n          .single();\n        if (sampleTrack) context.learning_track_id = sampleTrack.id;\n      }\n      \n      // For manager_employee_incomplete, use current user as manager\n      if (template.type === 'manager_employee_incomplete') {\n        context.manager_id = sampleUser.id;\n      }\n      \n      // Add score for quiz templates\n      if (template.type === 'quiz_high_score') {\n        context.score = 95;\n      }\n      \n      // Use gatherTemplateVariables to get real variables from database\n      // Pass template HTML body to look up any missing variables from template_variables table\n      const templateBody = template.html_body_template || '';\n      const variables = await gatherTemplateVariables(supabaseClient, template.type, context, templateBody);\n      setPreviewVariables(variables);\n    } catch (error) {\n      console.error('Error gathering preview variables:', error);\n      setPreviewVariables(null);\n    } finally {\n      setLoadingPreview(false);\n    }\n  };\n\n  const handleDelete = async (template: EmailTemplate) => {\n    if (template.is_system) {\n      alert('System templates cannot be deleted');\n      return;\n    }\n\n    if (confirm(`Are you sure you want to delete \"${template.name}\"?`)) {\n      try {\n        const { error } = await supabaseClient\n          .from('email_templates')\n          .delete()\n          .eq('id', template.id);\n\n        if (error) throw error;\n        loadTemplates();\n      } catch (err: any) {\n        alert(`Error deleting template: ${err.message}`);\n      }\n    }\n  };\n\n  const handleDuplicate = async (template: EmailTemplate) => {\n    try {\n      const { error } = await supabaseClient\n        .from('email_templates')\n        .insert({\n          name: `${template.name} (Copy)`,\n          type: template.type,\n          subject_template: template.subject_template,\n          html_body_template: template.html_body_template,\n          text_body_template: template.text_body_template,\n          is_system: false\n        });\n\n      if (error) throw error;\n      loadTemplates();\n    } catch (err: any) {\n      alert(`Error duplicating template: ${err.message}`);\n    }\n  };\n\n  const handleSendTest = async (template: EmailTemplate) => {\n    try {\n      setSendingEmail(template.id);\n      \n      // Get current user's email for testing\n      const { data: { user } } = await supabaseClient.auth.getUser();\n      if (!user?.email) {\n        setEmailDialog({\n          open: true,\n          type: 'error',\n          message: 'No user email found for testing'\n        });\n        return;\n      }\n\n      // Use gatherTemplateVariables to get real data from database\n      // gatherTemplateVariables is required - no fallback to hardcoded values\n      if (!gatherTemplateVariables) {\n        setEmailDialog({\n          open: true,\n          type: 'error',\n          message: 'gatherTemplateVariables is required for test emails'\n        });\n        setSendingEmail(null);\n        return;\n      }\n      \n      const context: any = { user_id: user.id };\n      \n      // Try to get sample lesson_id for lesson-related templates\n      if (template.type === 'lesson_completed' || template.type === 'quiz_high_score' || template.type === 'lesson_reminder') {\n        const { data: sampleLesson } = await supabaseClient\n          .from('lessons')\n          .select('id')\n          .limit(1)\n          .single();\n        if (sampleLesson) context.lesson_id = sampleLesson.id;\n      }\n      \n      // Try to get sample learning_track_id for track-related templates\n      if (template.type.includes('track_milestone') || template.type === 'lesson_completed') {\n        const { data: sampleTrack } = await supabaseClient\n          .from('learning_tracks')\n          .select('id')\n          .limit(1)\n          .single();\n        if (sampleTrack) context.learning_track_id = sampleTrack.id;\n      }\n      \n      // For manager_employee_incomplete, use current user as manager\n      if (template.type === 'manager_employee_incomplete') {\n        context.manager_id = user.id;\n      }\n      \n      // Add score for quiz templates\n      if (template.type === 'quiz_high_score') {\n        context.score = 95;\n      }\n      \n      // Pass template HTML body to look up any missing variables from template_variables table\n      const templateBody = template.html_body_template || '';\n      const templateVariables = await gatherTemplateVariables(supabaseClient, template.type, context, templateBody);\n      \n      // Create a notification record first to track the test email\n      const { data: notificationData, error: notificationError } = await supabaseClient\n        .from('notification_history')\n        .insert({\n          user_id: user.id,\n          email_template_id: template.id, // Include the template ID!\n          trigger_event: template.type,\n          template_variables: templateVariables,\n          status: 'pending',\n          channel: 'email',\n          priority: 'normal'\n        })\n        .select('id')\n        .single();\n\n      if (notificationError) {\n        console.error('Failed to create notification record:', notificationError);\n        // Continue without notification tracking\n      }\n      \n      // Use the EmailService to send test email with the actual template data\n      const { emailService } = await import('../lib/emailService');\n      const service = emailService;\n      \n      // Use the actual template data instead of looking it up by type\n      const result = await service.sendEmailWithTemplate(\n        template.subject_template,\n        template.html_body_template,\n        template.text_body_template || '',\n        user.email,\n        templateVariables,\n        supabaseClient,\n        notificationData?.id // Pass notification ID for status tracking\n      );\n\n      if (result.success) {\n        setEmailDialog({\n          open: true,\n          type: 'success',\n          message: `Test email for \"${template.name}\" sent successfully to ${user.email}`\n        });\n      } else {\n        setEmailDialog({\n          open: true,\n          type: 'error',\n          message: `Failed to send test email for \"${template.name}\": ${result.error}`\n        });\n      }\n    } catch (err: any) {\n      setEmailDialog({\n        open: true,\n        type: 'error',\n        message: `Error sending test email for \"${template.name}\": ${err.message}`\n      });\n    } finally {\n      setSendingEmail(null);\n    }\n  };\n\n  const handleCreate = () => {\n    setSelectedTemplate({\n      id: '',\n      name: '',\n      type: '',\n      subject_template: '',\n      html_body_template: '',\n      text_body_template: '',\n      is_system: false,\n      is_active: true,\n      created_at: new Date().toISOString()\n    });\n    setIsCreating(true);\n    setIsEditing(true);\n  };\n\n  const handleSave = async () => {\n    if (!selectedTemplate) return;\n\n    try {\n      const templateData = {\n        name: selectedTemplate.name,\n        type: selectedTemplate.type,\n        subject_template: selectedTemplate.subject_template,\n        html_body_template: selectedTemplate.html_body_template,\n        text_body_template: selectedTemplate.text_body_template,\n        is_system: selectedTemplate.is_system,\n        is_active: selectedTemplate.is_active\n      };\n\n      if (isCreating) {\n        // Create new template\n        const { error } = await supabaseClient\n          .from('email_templates')\n          .insert(templateData);\n        \n        if (error) throw error;\n        if (toast) {\n          toast({ title: 'Template created successfully' });\n        } else {\n          alert('Template created successfully');\n        }\n      } else {\n        // Update existing template\n        const { error } = await supabaseClient\n          .from('email_templates')\n          .update(templateData)\n          .eq('id', selectedTemplate.id);\n        \n        if (error) throw error;\n        if (toast) {\n          toast({ title: 'Template updated successfully' });\n        } else {\n          alert('Template updated successfully');\n        }\n      }\n\n      setIsEditing(false);\n      setIsCreating(false);\n      setSelectedTemplate(null);\n      loadTemplates();\n    } catch (err: any) {\n      if (toast) {\n        toast({ \n          title: 'Error saving template', \n          description: err.message,\n          variant: 'destructive' \n        });\n      } else {\n        alert(`Error saving template: ${err.message}`);\n      }\n    }\n  };\n\n  const filteredTemplates = templates.filter(template => {\n    const matchesSearch = \n      template.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      template.type.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      template.subject_template.toLowerCase().includes(searchTerm.toLowerCase());\n    \n    const matchesStatus = statusFilter === 'all' || \n      (statusFilter === 'system' && template.is_system) ||\n      (statusFilter === 'custom' && !template.is_system);\n    \n    const matchesType = typeFilter === 'all' || template.type === typeFilter;\n    \n    return matchesSearch && matchesStatus && matchesType;\n  });\n\n  const getTypeColor = (type: string) => {\n    switch (type) {\n      case 'lesson_completed': return 'bg-green-100 text-green-800';\n      case 'track_milestone': return 'bg-blue-100 text-blue-800';\n      case 'quiz_high_score': return 'bg-purple-100 text-purple-800';\n      case 'lesson_reminder': return 'bg-orange-100 text-orange-800';\n      default: return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('en-US', {\n      month: 'short',\n      day: 'numeric',\n      year: 'numeric'\n    });\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-8\">\n        <div className=\"text-muted-foreground\">Loading templates...</div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <Alert className=\"mb-4\">\n        <AlertDescription>Error loading templates: {error}</AlertDescription>\n      </Alert>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-learning-primary\">Email Template Management</h2>\n          <p className=\"text-muted-foreground\">Create and manage email templates</p>\n        </div>\n        {isSuperAdmin ? (\n          <div className=\"flex items-center space-x-2\">\n            <Button \n              onClick={handleCreate}\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Create Template\n            </Button>\n          </div>\n        ) : (\n          <div className=\"text-sm text-muted-foreground\">\n            Template creation requires Super Admin access\n          </div>\n        )}\n      </div>\n\n      {/* Filters */}\n      <div className=\"flex flex-col sm:flex-row gap-4\">\n        <div className=\"flex-1\">\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n            <Input\n              placeholder=\"Search templates...\"\n              value={searchTerm}\n              onChange={(e: React.ChangeEvent<HTMLInputElement>) => setSearchTerm(e.target.value)}\n              className=\"pl-10\"\n            />\n          </div>\n        </div>\n        <div className=\"flex gap-2\">\n          <Select value={statusFilter} onValueChange={setStatusFilter}>\n            <SelectTrigger className=\"w-32\">\n              <SelectValue placeholder=\"Status\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">All Status</SelectItem>\n              <SelectItem value=\"system\">System</SelectItem>\n              <SelectItem value=\"custom\">Custom</SelectItem>\n            </SelectContent>\n          </Select>\n          <Select value={typeFilter} onValueChange={setTypeFilter}>\n            <SelectTrigger className=\"w-40\">\n              <SelectValue placeholder=\"Type\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">All Types</SelectItem>\n              <SelectItem value=\"lesson_completed\">Lesson Completed</SelectItem>\n              <SelectItem value=\"lesson_reminder\">Lesson Reminder</SelectItem>\n              <SelectItem value=\"quiz_high_score\">Quiz High Score</SelectItem>\n              <SelectItem value=\"track_milestone\">Track Milestone</SelectItem>\n              <SelectItem value=\"system_alert\">System Alert</SelectItem>\n              <SelectItem value=\"task_due\">Task Due</SelectItem>\n              <SelectItem value=\"achievement\">Achievement</SelectItem>\n              <SelectItem value=\"course_completion\">Course Completion</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      {/* Templates List */}\n      {filteredTemplates.length === 0 ? (\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-12\">\n            <Mail className=\"h-12 w-12 text-muted-foreground mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">No templates found</h3>\n            <p className=\"text-muted-foreground text-center\">\n              {searchTerm ? 'No templates match your search.' : 'Create your first email template to get started.'}\n            </p>\n          </CardContent>\n        </Card>\n      ) : (\n        <Card>\n          <CardContent className=\"p-0\">\n            <div className=\"overflow-x-auto\">\n              <table className=\"w-full\">\n                <thead>\n                  <tr className=\"border-b\">\n                    <th className=\"text-left p-4 font-medium\">Template</th>\n                    <th className=\"text-left p-4 font-medium\">Type</th>\n                    <th className=\"text-left p-4 font-medium\">Created</th>\n                    <th className=\"text-left p-4 font-medium\">Updated</th>\n                    <th className=\"text-left p-4 font-medium\">Actions</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {filteredTemplates.map((template) => (\n                    <tr key={template.id} className=\"border-b hover:bg-gray-50\">\n                      <td className=\"p-4\">\n                        <div className=\"text-left\">\n                          <div className=\"font-medium\">{template.name}</div>\n                          <div className=\"text-sm text-muted-foreground\">\n                            {template.subject_template}\n                          </div>\n                        </div>\n                      </td>\n                      <td className=\"p-4\">\n                        <Badge className={getTypeColor(template.type)}>\n                          {template.type.replace('_', ' ')}\n                        </Badge>\n                      </td>\n                      <td className=\"p-4 text-sm text-muted-foreground\">\n                        {formatDate(template.created_at)}\n                      </td>\n                      <td className=\"p-4 text-sm text-muted-foreground\">\n                        {template.updated_at ? formatDate(template.updated_at) : '-'}\n                      </td>\n                      <td className=\"p-4\">\n                        <div className=\"flex items-center space-x-2\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleEdit(template)}\n                            title=\"Edit Template\"\n                          >\n                            <Edit className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleView(template)}\n                            title=\"View Template\"\n                          >\n                            <Eye className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleDuplicate(template)}\n                            title=\"Duplicate Template\"\n                          >\n                            <Copy className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleSendTest(template)}\n                            title=\"Send Test Email\"\n                            disabled={sendingEmail === template.id}\n                          >\n                            {sendingEmail === template.id ? (\n                              <Loader2 \n                                className=\"h-4 w-4\" \n                                style={{ \n                                  animation: 'spin 1s linear infinite',\n                                  transformOrigin: 'center'\n                                }}\n                              />\n                            ) : (\n                              <Send className=\"h-4 w-4\" />\n                            )}\n                          </Button>\n                          {!template.is_system && (\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => handleDelete(template)}\n                              className=\"text-red-600 hover:text-red-700\"\n                              title=\"Delete Template\"\n                              style={{ backgroundColor: 'orange', color: 'white' }}\n                            >\n                              <Trash2 className=\"h-4 w-4\" />\n                            </Button>\n                          )}\n                        </div>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Edit/View Dialog */}\n      {(isEditing || isViewing) && selectedTemplate && (\n        <Dialog open={isEditing || isViewing} onOpenChange={() => {\n          setIsEditing(false);\n          setIsViewing(false);\n          setIsCreating(false);\n          setSelectedTemplate(null);\n        }}>\n          <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>\n                {isCreating ? 'Create Template' : isEditing ? 'Edit Template' : 'Email Preview'}: {selectedTemplate.name || 'New Template'}\n              </DialogTitle>\n            </DialogHeader>\n            {isViewing ? (\n              /* Email Preview Mode */\n              <div className=\"space-y-4\">\n                <div className=\"border rounded-lg p-4 bg-white\">\n                  <div className=\"border-b pb-2 mb-4\">\n                    <h3 className=\"font-semibold text-gray-700\">Email Preview</h3>\n                    <p className=\"text-sm text-gray-500\">How this email will appear to recipients</p>\n                  </div>\n                  \n                  <div className=\"space-y-4\">\n                    <div>\n                      <Label className=\"text-sm font-medium text-gray-600\">Subject:</Label>\n                      <div className=\"mt-1 p-2 bg-gray-50 rounded border\">\n                        {loadingPreview ? (\n                          'Loading preview...'\n                        ) : previewVariables ? (\n                          // Use real variables from database via gatherTemplateVariables\n                          emailService.substituteVariables(selectedTemplate.subject_template, previewVariables)\n                        ) : (\n                          'Error loading preview variables'\n                        )}\n                      </div>\n                    </div>\n                    \n                    <div>\n                      <Label className=\"text-sm font-medium text-gray-600\">Email Body:</Label>\n                      <div className=\"mt-1 border rounded bg-white max-h-96 overflow-y-auto\">\n                        <div \n                          className=\"p-4 prose max-w-none\"\n                          dangerouslySetInnerHTML={{\n                            __html: loadingPreview ? (\n                              '<div>Loading preview...</div>'\n                            ) : previewVariables ? (\n                              (() => {\n                                // Debug: log what we're passing to substituteVariables\n                                console.log('Preview - calling substituteVariables with:', {\n                                  template: selectedTemplate.html_body_template.substring(0, 200) + '...',\n                                  variables: {\n                                    ...previewVariables,\n                                    incomplete_lessons: Array.isArray(previewVariables.incomplete_lessons) \n                                      ? `Array(${previewVariables.incomplete_lessons.length})` \n                                      : previewVariables.incomplete_lessons\n                                  }\n                                });\n                                const result = emailService.substituteVariables(selectedTemplate.html_body_template, previewVariables);\n                                console.log('Preview - substituteVariables result:', result.substring(0, 500) + '...');\n                                return result;\n                              })()\n                            ) : (\n                              '<div>Error loading preview variables</div>'\n                            )\n                          }}\n                        />\n                      </div>\n                    </div>\n                  </div>\n                </div>\n                \n                <div className=\"flex justify-end\">\n                  <Button variant=\"outline\" onClick={() => {\n                    setIsViewing(false);\n                    setSelectedTemplate(null);\n                    setPreviewVariables(null);\n                  }}>\n                    Close Preview\n                  </Button>\n                </div>\n              </div>\n            ) : (\n              /* Edit/Create Mode */\n              <div className=\"space-y-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <Label htmlFor=\"name\">Template Name</Label>\n                    <Input\n                      id=\"name\"\n                      value={selectedTemplate.name}\n                      disabled={!isEditing || selectedTemplate.is_system}\n                      onChange={(e: React.ChangeEvent<HTMLInputElement>) => setSelectedTemplate({\n                        ...selectedTemplate,\n                        name: e.target.value\n                      })}\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"type\">Template Type</Label>\n                    <Input\n                      id=\"type\"\n                      value={selectedTemplate.type}\n                      disabled={!isEditing || selectedTemplate.is_system}\n                      onChange={(e: React.ChangeEvent<HTMLInputElement>) => setSelectedTemplate({\n                        ...selectedTemplate,\n                        type: e.target.value\n                      })}\n                    />\n                  </div>\n                </div>\n                <div>\n                  <Label htmlFor=\"subject\">Subject</Label>\n                  <Input\n                    id=\"subject\"\n                    value={selectedTemplate.subject_template}\n                    disabled={!isEditing}\n                    onChange={(e: React.ChangeEvent<HTMLInputElement>) => setSelectedTemplate({\n                      ...selectedTemplate,\n                      subject_template: e.target.value\n                    })}\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"content\">HTML Content</Label>\n                  <Textarea\n                    id=\"content\"\n                    value={selectedTemplate.html_body_template}\n                    disabled={!isEditing}\n                    rows={10}\n                    className=\"font-mono text-sm\"\n                    onChange={(e: React.ChangeEvent<HTMLTextAreaElement>) => setSelectedTemplate({\n                      ...selectedTemplate,\n                      html_body_template: e.target.value\n                    })}\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"text-content\">Text Content (Optional)</Label>\n                  <Textarea\n                    id=\"text-content\"\n                    value={selectedTemplate.text_body_template || ''}\n                    disabled={!isEditing}\n                    rows={5}\n                    className=\"font-mono text-sm\"\n                    onChange={(e: React.ChangeEvent<HTMLTextAreaElement>) => setSelectedTemplate({\n                      ...selectedTemplate,\n                      text_body_template: e.target.value\n                    })}\n                  />\n                </div>\n                {isEditing && (\n                  <div className=\"flex justify-end space-x-2\">\n                    <Button variant=\"outline\" onClick={() => {\n                      setIsEditing(false);\n                      setIsCreating(false);\n                      setSelectedTemplate(null);\n                    }}>\n                      Cancel\n                    </Button>\n                    <Button onClick={handleSave}>\n                      {isCreating ? 'Create' : 'Save'}\n                    </Button>\n                  </div>\n                )}\n              </div>\n            )}\n          </DialogContent>\n        </Dialog>\n      )}\n\n      {/* Email Send Result Dialog */}\n      <Dialog open={emailDialog.open} onOpenChange={(open: boolean) => setEmailDialog({ ...emailDialog, open })}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              {emailDialog.type === 'success' ? (\n                <CheckCircle className=\"h-5 w-5 text-green-600\" />\n              ) : (\n                <XCircle className=\"h-5 w-5 text-red-600\" />\n              )}\n              {emailDialog.type === 'success' ? 'Email Sent Successfully' : 'Email Send Failed'}\n            </DialogTitle>\n          </DialogHeader>\n          <div className=\"py-4\">\n            <p className=\"text-sm text-gray-600\">{emailDialog.message}</p>\n          </div>\n          <div className=\"flex justify-end\">\n            <Button onClick={() => setEmailDialog({ ...emailDialog, open: false })}>\n              OK\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","import React, { useState, useEffect } from 'react';\nimport { \n  Search, \n  Mail, \n  Clock, \n  CheckCircle, \n  XCircle, \n  AlertCircle,\n  User,\n  Calendar,\n  Filter,\n  RefreshCw\n} from 'lucide-react';\n\ninterface EmailNotification {\n  id: string;\n  user_id: string;\n  type: string;\n  title: string;\n  message: string;\n  email: string;\n  status: 'pending' | 'sent' | 'failed';\n  created_at: string;\n  sent_at?: string;\n  error_message?: string;\n}\n\ninterface RecentEmailNotificationsProps {\n  supabaseClient: any;\n  Button: any;\n  Card: any;\n  CardContent: any;\n  CardDescription: any;\n  CardHeader: any;\n  CardTitle: any;\n  Input: any;\n  Label: any;\n  Badge: any;\n  Select: any;\n  SelectContent: any;\n  SelectItem: any;\n  SelectTrigger: any;\n  SelectValue: any;\n  Alert: any;\n  AlertDescription: any;\n}\n\nexport default function RecentEmailNotifications({\n  supabaseClient,\n  Button,\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n  Input,\n  Label,\n  Badge,\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n  Alert,\n  AlertDescription\n}: RecentEmailNotificationsProps) {\n  const [notifications, setNotifications] = useState<EmailNotification[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [statusFilter, setStatusFilter] = useState<string>('all');\n  const [typeFilter, setTypeFilter] = useState<string>('all');\n\n  // Load recent notifications\n  useEffect(() => {\n    loadNotifications();\n  }, []);\n\n  const loadNotifications = async () => {\n    try {\n      setLoading(true);\n\n      // Fetch notifications\n      const { data: notifications, error } = await supabaseClient\n        .from('notification_history')\n        .select('*')\n        .order('sent_at', { ascending: false, nullsFirst: false })\n        .limit(100); // Show last 100 notifications\n\n      if (error) throw error;\n\n      if (!notifications || notifications.length === 0) {\n        setNotifications([]);\n        setLoading(false);\n        return;\n      }\n\n      // Get unique user IDs\n      const userIds = [...new Set(notifications.map((n: any) => n.user_id))];\n\n      // Fetch user emails from profiles\n      // Note: email is stored in username field in profiles table\n      const { data: profiles, error: profilesError } = await supabaseClient\n        .from('profiles')\n        .select('id, username')\n        .in('id', userIds);\n\n      if (profilesError) {\n        console.error('Error fetching profiles:', profilesError);\n      }\n\n      // Create a map of user_id -> email\n      // Note: username field stores the email address\n      const emailMap = new Map<string, string>();\n      profiles?.forEach((profile: any) => {\n        if (profile.username) {\n          emailMap.set(profile.id, profile.username);\n        }\n      });\n      \n      // Map notification_history fields to the expected format\n      const mappedData = notifications.map((notification: any) => ({\n        id: notification.id,\n        title: notification.trigger_event.replace('_', ' ').replace(/\\b\\w/g, (l: string) => l.toUpperCase()),\n        message: `Notification of type ${notification.trigger_event}`,\n        type: notification.trigger_event,\n        status: notification.status,\n        email: emailMap.get(notification.user_id) || 'Unknown User',\n        sent_at: notification.sent_at,\n        error_message: notification.error_message\n      }));\n      \n      setNotifications(mappedData);\n    } catch (err: any) {\n      setError(err.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const getStatusStyle = (status: string) => {\n    switch (status) {\n      case 'sent': return { backgroundColor: '#dcfce7', color: '#166534', borderColor: '#bbf7d0' };\n      case 'failed': return { backgroundColor: '#fecaca', color: '#991b1b', borderColor: '#fca5a5' };\n      case 'pending': return { backgroundColor: '#fef3c7', color: '#92400e', borderColor: '#fde68a' };\n      default: return { backgroundColor: '#f3f4f6', color: '#374151', borderColor: '#d1d5db' };\n    }\n  };\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case 'sent': return <CheckCircle className=\"h-4 w-4\" />;\n      case 'failed': return <XCircle className=\"h-4 w-4\" />;\n      case 'pending': return <Clock className=\"h-4 w-4\" />;\n      default: return <AlertCircle className=\"h-4 w-4\" />;\n    }\n  };\n\n  const getTypeStyle = (type: string) => {\n    switch (type) {\n      case 'lesson_completed': return { backgroundColor: '#dcfce7', color: '#166534', borderColor: '#bbf7d0' };\n      case 'lesson_reminder': return { backgroundColor: '#fed7aa', color: '#9a3412', borderColor: '#fdba74' };\n      case 'quiz_high_score': return { backgroundColor: '#e9d5ff', color: '#6b21a8', borderColor: '#d8b4fe' };\n      case 'track_milestone': return { backgroundColor: '#dbeafe', color: '#1e40af', borderColor: '#bfdbfe' };\n      case 'system_alert': return { backgroundColor: '#fecaca', color: '#991b1b', borderColor: '#fca5a5' };\n      case 'task_due': return { backgroundColor: '#fef3c7', color: '#92400e', borderColor: '#fde68a' };\n      case 'achievement': return { backgroundColor: '#fce7f3', color: '#be185d', borderColor: '#f9a8d4' };\n      case 'course_completion': return { backgroundColor: '#e0e7ff', color: '#3730a3', borderColor: '#c7d2fe' };\n      default: return { backgroundColor: '#f3f4f6', color: '#374151', borderColor: '#d1d5db' };\n    }\n  };\n\n  const formatDate = (dateString: string | null | undefined) => {\n    if (!dateString) return 'N/A';\n    \n    try {\n      const date = new Date(dateString);\n      if (isNaN(date.getTime())) return 'Invalid Date';\n      \n      return date.toLocaleDateString('en-US', {\n        month: 'short',\n        day: 'numeric',\n        year: 'numeric',\n        hour: '2-digit',\n        minute: '2-digit'\n      });\n    } catch (error) {\n      return 'Invalid Date';\n    }\n  };\n\n  const filteredNotifications = notifications.filter(notification => {\n    const matchesSearch = \n      notification.title.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      notification.email.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      notification.type.toLowerCase().includes(searchTerm.toLowerCase());\n    \n    const matchesStatus = statusFilter === 'all' || notification.status === statusFilter;\n    const matchesType = typeFilter === 'all' || notification.type === typeFilter;\n    \n    return matchesSearch && matchesStatus && matchesType;\n  });\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-8\">\n        <div className=\"text-muted-foreground\">Loading recent notifications...</div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <Alert className=\"mb-4\">\n        <AlertDescription>Error loading notifications: {error}</AlertDescription>\n      </Alert>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-learning-primary\">Recent Email Notifications</h2>\n          <p className=\"text-muted-foreground\">View sent email notifications and their status</p>\n        </div>\n        <div className=\"flex items-center space-x-2\">\n          <Button variant=\"outline\" size=\"sm\" onClick={loadNotifications}>\n            <RefreshCw className=\"h-4 w-4 mr-2\" />\n            Refresh\n          </Button>\n        </div>\n      </div>\n\n      {/* Summary Stats */}\n      {notifications.length > 0 && (\n        <div className=\"flex flex-row gap-4\">\n          <Card className=\"flex-1\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center space-x-2\">\n                <CheckCircle className=\"h-5 w-5 text-green-600\" />\n                <div>\n                  <div className=\"text-2xl font-bold text-green-600\">\n                    {notifications.filter(n => n.status === 'sent').length}\n                  </div>\n                  <div className=\"text-sm text-muted-foreground\">Sent</div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n          <Card className=\"flex-1\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center space-x-2\">\n                <XCircle className=\"h-5 w-5 text-red-600\" />\n                <div>\n                  <div className=\"text-2xl font-bold text-red-600\">\n                    {notifications.filter(n => n.status === 'failed').length}\n                  </div>\n                  <div className=\"text-sm text-muted-foreground\">Failed</div>\n                  {notifications.filter(n => n.status === 'failed').length > 0 && (\n                    <div className=\"text-xs text-red-700 mt-1 font-medium\">\n                      Check error messages above\n                    </div>\n                  )}\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n          <Card className=\"flex-1\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center space-x-2\">\n                <Clock className=\"h-5 w-5 text-yellow-600\" />\n                <div>\n                  <div className=\"text-2xl font-bold text-yellow-600\">\n                    {notifications.filter(n => n.status === 'pending').length}\n                  </div>\n                  <div className=\"text-sm text-muted-foreground\">Pending</div>\n                  {notifications.filter(n => n.status === 'pending').length > 0 && (\n                    <div className=\"text-xs text-yellow-700 mt-1 font-medium\">\n                      Being processed\n                    </div>\n                  )}\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n          <Card className=\"flex-1\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center space-x-2\">\n                <Mail className=\"h-5 w-5 text-blue-600\" />\n                <div>\n                  <div className=\"text-2xl font-bold text-blue-600\">\n                    {notifications.length}\n                  </div>\n                  <div className=\"text-sm text-muted-foreground\">Total</div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n      \n      {/* Filters */}\n      <div className=\"flex flex-col sm:flex-row gap-4\">\n        <div className=\"flex-1\">\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n            <Input\n              placeholder=\"Search notifications...\"\n              value={searchTerm}\n              onChange={(e: React.ChangeEvent<HTMLInputElement>) => setSearchTerm(e.target.value)}\n              className=\"pl-10\"\n            />\n          </div>\n        </div>\n        <div className=\"flex gap-2\">\n          <Select value={statusFilter} onValueChange={setStatusFilter}>\n            <SelectTrigger className=\"w-32\">\n              <SelectValue placeholder=\"Status\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">All Status</SelectItem>\n              <SelectItem value=\"sent\">Sent</SelectItem>\n              <SelectItem value=\"failed\">Failed</SelectItem>\n              <SelectItem value=\"pending\">Pending</SelectItem>\n            </SelectContent>\n          </Select>\n          <Select value={typeFilter} onValueChange={setTypeFilter}>\n            <SelectTrigger className=\"w-40\">\n              <SelectValue placeholder=\"Type\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">All Types</SelectItem>\n              <SelectItem value=\"lesson_completed\">Lesson Completed</SelectItem>\n              <SelectItem value=\"lesson_reminder\">Lesson Reminder</SelectItem>\n              <SelectItem value=\"quiz_high_score\">Quiz High Score</SelectItem>\n              <SelectItem value=\"track_milestone\">Track Milestone</SelectItem>\n              <SelectItem value=\"system_alert\">System Alert</SelectItem>\n              <SelectItem value=\"task_due\">Task Due</SelectItem>\n              <SelectItem value=\"achievement\">Achievement</SelectItem>\n              <SelectItem value=\"course_completion\">Course Completion</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      {/* Notifications List */}\n      {filteredNotifications.length === 0 ? (\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-12\">\n            <Mail className=\"h-12 w-12 text-muted-foreground mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">No notifications found</h3>\n            <p className=\"text-muted-foreground text-center\">\n              {searchTerm || statusFilter !== 'all' || typeFilter !== 'all' \n                ? 'No notifications match your filters.' \n                : 'No email notifications have been sent yet.'}\n            </p>\n          </CardContent>\n        </Card>\n      ) : (\n        <Card>\n          <CardContent className=\"p-0\">\n            <div className=\"overflow-x-auto\">\n              <table className=\"w-full\">\n                <thead>\n                  <tr className=\"border-b bg-gray-50\">\n                    <th className=\"text-left p-4 font-medium\">Notification</th>\n                    <th className=\"text-left p-4 font-medium\">Type</th>\n                    <th className=\"text-left p-4 font-medium\">Status</th>\n                    <th className=\"text-left p-4 font-medium\">Recipient</th>\n                    <th className=\"text-left p-4 font-medium\">Sent</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {filteredNotifications.map((notification) => (\n                    <tr key={notification.id} className=\"border-b hover:bg-gray-50\">\n                      <td className=\"p-4\">\n                        <div className=\"text-left\">\n                          <div className=\"font-medium\">{notification.title}</div>\n                          <div className=\"text-sm text-muted-foreground line-clamp-2\">\n                            {notification.message}\n                          </div>\n                        </div>\n                      </td>\n                      <td className=\"p-4 text-left\">\n                        <span \n                          className=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border\"\n                          style={getTypeStyle(notification.type)}\n                        >\n                          {notification.type.replace('_', ' ')}\n                        </span>\n                      </td>\n                      <td className=\"p-4 text-left\">\n                        <div className=\"flex items-center space-x-2\">\n                          {getStatusIcon(notification.status)}\n                          <span \n                            className=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border\"\n                            style={getStatusStyle(notification.status)}\n                          >\n                            {notification.status}\n                          </span>\n                        </div>\n                        {notification.status === 'failed' && notification.error_message && (\n                          <div className=\"text-xs text-red-600 mt-1\">\n                            {notification.error_message}\n                          </div>\n                        )}\n                      </td>\n                      <td className=\"p-4 text-left\">\n                        <div className=\"flex items-center space-x-2\">\n                          <User className=\"h-4 w-4 text-muted-foreground\" />\n                          <span className=\"text-sm\">{notification.email}</span>\n                        </div>\n                      </td>\n                      <td className=\"p-4 text-left\">\n                        <div className=\"flex items-center space-x-2\">\n                          <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                          <div className=\"text-sm\">\n                            {notification.sent_at ? (\n                              formatDate(notification.sent_at)\n                            ) : (\n                              <span className=\"text-muted-foreground\">Not sent</span>\n                            )}\n                          </div>\n                        </div>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}\n","import { createClient } from '@supabase/supabase-js';\n\n// This should be configured by the consuming application\n// Don't auto-create supabase client - let consuming app provide it\nexport const supabase = null;\n\n// Helper function to configure Supabase for the notification module\nexport const configureSupabase = (url: string, anonKey: string) => {\n  return createClient(url, anonKey);\n};\n","import { useState, useEffect, useCallback } from 'react';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { supabase } from '../utils/supabase';\nimport type { \n  Notification, \n  NotificationFilters, \n  UseNotificationsReturn,\n  CreateNotificationRequest,\n  UpdateNotificationRequest \n} from '../types';\n\nexport const useNotifications = (filters: NotificationFilters = {}): UseNotificationsReturn => {\n  const queryClient = useQueryClient();\n  const [unreadCount, setUnreadCount] = useState(0);\n\n  // Fetch notifications\n  const {\n    data: notifications = [],\n    isLoading,\n    error,\n    refetch\n  } = useQuery({\n    queryKey: ['notifications', filters],\n    queryFn: async (): Promise<Notification[]> => {\n      let query = supabase\n        .from('notifications')\n        .select('*')\n        .order('created_at', { ascending: false });\n\n      // Apply filters\n      if (filters.userId) {\n        query = query.eq('user_id', filters.userId);\n      }\n      if (filters.type) {\n        query = query.eq('type', filters.type);\n      }\n      if (filters.status) {\n        query = query.eq('status', filters.status);\n      }\n      if (filters.priority) {\n        query = query.eq('priority', filters.priority);\n      }\n      if (filters.fromDate) {\n        query = query.gte('created_at', filters.fromDate.toISOString());\n      }\n      if (filters.toDate) {\n        query = query.lte('created_at', filters.toDate.toISOString());\n      }\n      if (filters.unreadOnly) {\n        query = query.is('read_at', null);\n      }\n      if (filters.limit) {\n        query = query.limit(filters.limit);\n      }\n      if (filters.offset) {\n        query = query.range(filters.offset, filters.offset + (filters.limit || 50) - 1);\n      }\n\n      const { data, error } = await query;\n\n      if (error) {\n        throw new Error(`Failed to fetch notifications: ${error.message}`);\n      }\n\n      return data?.map(notification => ({\n        ...notification,\n        createdAt: new Date(notification.created_at),\n        scheduledFor: notification.scheduled_for ? new Date(notification.scheduled_for) : undefined,\n        readAt: notification.read_at ? new Date(notification.read_at) : undefined,\n        expiresAt: notification.expires_at ? new Date(notification.expires_at) : undefined,\n      })) || [];\n    },\n    refetchInterval: 30000, // Refetch every 30 seconds\n  });\n\n  // Fetch unread count\n  const { data: unreadData } = useQuery({\n    queryKey: ['notifications', 'unread-count', filters.userId],\n    queryFn: async (): Promise<number> => {\n      if (!filters.userId) return 0;\n\n      const { count, error } = await supabase\n        .from('notifications')\n        .select('*', { count: 'exact', head: true })\n        .eq('user_id', filters.userId)\n        .is('read_at', null);\n\n      if (error) {\n        throw new Error(`Failed to fetch unread count: ${error.message}`);\n      }\n\n      return count || 0;\n    },\n    refetchInterval: 10000, // Refetch every 10 seconds\n  });\n\n  // Update unread count when data changes\n  useEffect(() => {\n    if (unreadData !== undefined) {\n      setUnreadCount(unreadData);\n    }\n  }, [unreadData]);\n\n  // Mark notification as read\n  const markAsReadMutation = useMutation({\n    mutationFn: async (id: string): Promise<void> => {\n      const { error } = await supabase\n        .from('notifications')\n        .update({ \n          read_at: new Date().toISOString(),\n          status: 'read'\n        })\n        .eq('id', id);\n\n      if (error) {\n        throw new Error(`Failed to mark notification as read: ${error.message}`);\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['notifications'] });\n      queryClient.invalidateQueries({ queryKey: ['notifications', 'unread-count'] });\n    },\n  });\n\n  // Mark all notifications as read\n  const markAllAsReadMutation = useMutation({\n    mutationFn: async (): Promise<void> => {\n      if (!filters.userId) return;\n\n      const { error } = await supabase\n        .from('notifications')\n        .update({ \n          read_at: new Date().toISOString(),\n          status: 'read'\n        })\n        .eq('user_id', filters.userId)\n        .is('read_at', null);\n\n      if (error) {\n        throw new Error(`Failed to mark all notifications as read: ${error.message}`);\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['notifications'] });\n      queryClient.invalidateQueries({ queryKey: ['notifications', 'unread-count'] });\n    },\n  });\n\n  // Delete notification\n  const deleteNotificationMutation = useMutation({\n    mutationFn: async (id: string): Promise<void> => {\n      const { error } = await supabase\n        .from('notifications')\n        .delete()\n        .eq('id', id);\n\n      if (error) {\n        throw new Error(`Failed to delete notification: ${error.message}`);\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['notifications'] });\n      queryClient.invalidateQueries({ queryKey: ['notifications', 'unread-count'] });\n    },\n  });\n\n  const markAsRead = useCallback(async (id: string) => {\n    await markAsReadMutation.mutateAsync(id);\n  }, [markAsReadMutation]);\n\n  const markAllAsRead = useCallback(async () => {\n    await markAllAsReadMutation.mutateAsync();\n  }, [markAllAsReadMutation]);\n\n  const deleteNotification = useCallback(async (id: string) => {\n    await deleteNotificationMutation.mutateAsync(id);\n  }, [deleteNotificationMutation]);\n\n  const refresh = useCallback(() => {\n    refetch();\n  }, [refetch]);\n\n  return {\n    notifications,\n    unreadCount,\n    isLoading,\n    error: error as Error | null,\n    markAsRead,\n    markAllAsRead,\n    deleteNotification,\n    refresh,\n  };\n};\n\n// Hook for creating notifications\nexport const useCreateNotification = () => {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async (notification: CreateNotificationRequest): Promise<Notification> => {\n      const { data, error } = await supabase\n        .from('notifications')\n        .insert({\n          user_id: notification.userId,\n          type: notification.type,\n          title: notification.title,\n          message: notification.message,\n          priority: notification.priority || 'normal',\n          scheduled_for: notification.scheduledFor?.toISOString(),\n          action_url: notification.actionUrl,\n          metadata: notification.metadata,\n          status: 'pending',\n        })\n        .select()\n        .single();\n\n      if (error) {\n        throw new Error(`Failed to create notification: ${error.message}`);\n      }\n\n      return {\n        ...data,\n        createdAt: new Date(data.created_at),\n        scheduledFor: data.scheduled_for ? new Date(data.scheduled_for) : undefined,\n        readAt: data.read_at ? new Date(data.read_at) : undefined,\n        expiresAt: data.expires_at ? new Date(data.expires_at) : undefined,\n      };\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['notifications'] });\n      queryClient.invalidateQueries({ queryKey: ['notifications', 'unread-count'] });\n    },\n  });\n};\n\n// Hook for updating notifications\nexport const useUpdateNotification = () => {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async (update: UpdateNotificationRequest): Promise<void> => {\n      const updateData: any = {};\n      \n      if (update.status) {\n        updateData.status = update.status;\n      }\n      if (update.readAt) {\n        updateData.read_at = update.readAt.toISOString();\n      }\n\n      const { error } = await supabase\n        .from('notifications')\n        .update(updateData)\n        .eq('id', update.id);\n\n      if (error) {\n        throw new Error(`Failed to update notification: ${error.message}`);\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['notifications'] });\n      queryClient.invalidateQueries({ queryKey: ['notifications', 'unread-count'] });\n    },\n  });\n};\n"],"names":["forwardRef","createElement","supabase","useState","useEffect","jsx","jsxs","error","emailService","Edit","Loader2","CheckCircle","XCircle","notifications","AlertCircle","useQueryClient","useQuery","useMutation","useCallback"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]}